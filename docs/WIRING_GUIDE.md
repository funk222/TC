# ESP32-C6 温控器接线图

## ⚠️ 重要更新说明

**I2C引脚已更改**: GPIO 8/9 → GPIO 22/23  
**原因**: GPIO 8被nanoESP32-C6板载WS2812 RGB LED占用

## 📌 完整引脚分配表

| GPIO | 功能 | 模块 | 引脚名称 | 必需 | 备注 |
|------|------|------|----------|------|------|
| 4 | MAX6675 SO | 温度传感器 | SO/MISO | ✅ | 数据输出 |
| 5 | MAX6675 CS | 温度传感器 | CS | ✅ | 片选 |
| 6 | MAX6675 SCK | 温度传感器 | SCK | ✅ | 时钟 |
| 7 | 继电器 IN | 输出控制 | IN | ✅ | 加热器控制 |
| **8** | **RGB LED** | **板载** | **WS2812** | **✅** | **板载LED** ⭐ |
| 10 | 编码器 CLK | 输入 | CLK/A | ✅ | 旋转检测 |
| 11 | 编码器 DT | 输入 | DT/B | ✅ | 旋转检测 |
| 12 | 确认按键 | 输入 | BTN1 | ✅ | 主要操作 |
| 13 | 返回按键 | 输入 | BTN2 | ✅ | 返回/取消 |
| - | 编码器 SW | 输入 | SW | ⚠️ | 可选按键（默认不接） |
| **22** | **I2C SDA** | **显示** | **SDA** | **✅** | **OLED数据** ⚠️ |
| **23** | **I2C SCL** | **显示** | **SCL** | **✅** | **OLED时钟** ⚠️ |

**图例**:
- ✅ 必需连接
- ⚠️ 可选或已更改
- ⭐ 板载硬件

## 🔌 模块连接详细说明

### 1. MAX6675 热电偶模块
```
MAX6675模块          ESP32-C6
┌─────────────┐    ┌─────────────┐
│ VCC         ├────┤ 3.3V        │
│ GND         ├────┤ GND         │
│ SCK         ├────┤ GPIO 6      │
│ SO (MISO)   ├────┤ GPIO 4      │
│ CS          ├────┤ GPIO 5      │
│             │    │             │
│ T-  T+      │ ← K型热电偶
└─────────────┘    └─────────────┘
```

**注意事项**:
- 使用3.3V供电
- 热电偶极性：T+ (红), T- (蓝/黄)
- 测量范围：0-1024°C
- 读取间隔：>220ms

### 2. I2C OLED显示屏 (SSD1306)
```
OLED显示屏           ESP32-C6
┌─────────────┐    ┌─────────────┐
│ VCC         ├────┤ 3.3V        │
│ GND         ├────┤ GND         │
│ SDA         ├────┤ GPIO 22 ⚠️  │  ← 已更改 (原GPIO 8)
│ SCL         ├────┤ GPIO 23 ⚠️  │  ← 已更改 (原GPIO 9)
└─────────────┘    └─────────────┘
```

**注意事项**:
- I2C地址：0x3C (部分显示屏为0x3D)
- 分辨率：128x64像素
- 使用3.3V供电
- ⚠️ **引脚已从GPIO 8/9改为GPIO 22/23**

### 3. 旋转编码器 (KY-040或类似)
```
旋转编码器           ESP32-C6
┌─────────────┐    ┌─────────────┐
│ VCC         ├────┤ 3.3V        │
│ GND         ├────┤ GND         │
│ CLK (A)     ├────┤ GPIO 10     │
│ DT (B)      ├────┤ GPIO 11     │
│ SW (按键)   ├────┤ 不连接       │  ← 默认不接
└─────────────┘    └─────────────┘
```

**注意事项**:
- CLK和DT用于旋转检测
- SW按键为可选功能（已有独立确认键）
- 编码器类型：增量式，带防抖

### 4. 独立按键 (2个)
```
确认按键             ESP32-C6
┌─────────────┐    ┌─────────────┐
│ 按键一端    ├────┤ GPIO 12     │
│ 按键另一端  ├────┤ GND         │
└─────────────┘    └─────────────┘

返回按键             ESP32-C6
┌─────────────┐    ┌─────────────┐
│ 按键一端    ├────┤ GPIO 13     │
│ 按键另一端  ├────┤ GND         │
└─────────────┘    └─────────────┘
```

**注意事项**:
- 使用轻触开关
- 内部上拉已启用，按下时接地
- 软件防抖：200ms

### 5. 继电器模块
```
继电器模块           ESP32-C6/外部
┌─────────────┐    ┌─────────────┐
│ VCC         ├────┤ 5V (或3.3V) │  ← 根据模块规格
│ GND         ├────┤ GND         │
│ IN (信号)   ├────┤ GPIO 7      │
│             │    └─────────────┘
│ COM         │─┐
│ NO (常开)   │ ├─ 加热器电路
│ NC (常闭)   │─┘
└─────────────┘
```

**注意事项**:
- 选择合适的继电器电压（3.3V或5V触发）
- 负载电流根据加热器额定值选择
- 建议使用光耦隔离模块
- 高压电路注意安全！

### 6. RGB LED (板载)
```
nanoESP32-C6板载
┌─────────────────────┐
│  [WS2812 RGB LED]   │ ← GPIO 8
│  (板载，无需外接)    │
└─────────────────────┘
```

**注意事项**:
- GPIO 8直接连接板载WS2812
- 无需外接，代码自动控制
- 亮度可调：0-255
- 支持全彩显示

## 🎨 完整接线图

```
                        ╔═══════════════════════════╗
                        ║   nanoESP32-C6 v1.0       ║
                        ║                           ║
   3.3V ────────────────║ 3V3                       ║
   GND ─────────────────║ GND                       ║
                        ║                           ║
   ┌─ MAX6675 ──────────║                           ║
   │   SCK ─────────────║ GPIO 6                    ║
   │   SO ──────────────║ GPIO 4                    ║
   │   CS ──────────────║ GPIO 5                    ║
   └────────────────────║                           ║
                        ║                           ║
   ┌─ OLED (I2C) ───────║                           ║
   │   SDA ─────────────║ GPIO 22 ⚠️ (更改)        ║
   │   SCL ─────────────║ GPIO 23 ⚠️ (更改)        ║
   └────────────────────║                           ║
                        ║                           ║
   ┌─ Encoder ──────────║                           ║
   │   CLK ─────────────║ GPIO 10                   ║
   │   DT ──────────────║ GPIO 11                   ║
   │   SW ──────────────║ 不连接（默认）             ║
   └────────────────────║                           ║
                        ║                           ║
   ┌─ Buttons ──────────║                           ║
   │   CONFIRM ─────────║ GPIO 12 ⭐ 主要          ║
   │   BACK ────────────║ GPIO 13 ⭐ 主要          ║
   └────────────────────║                           ║
                        ║                           ║
   ┌─ Relay ────────────║                           ║
   │   IN ──────────────║ GPIO 7                    ║
   │   VCC ─── 5V       ║                           ║
   │   GND ─── GND      ║                           ║
   └────────────────────║                           ║
                        ║                           ║
   RGB LED (板载) ⭐────║ GPIO 8 (WS2812)          ║
   无需外接             ║ 自动控制                   ║
                        ╚═══════════════════════════╝
```

## 🛠️ 9针控制板集成方案

如果使用9针集成控制板（OLED+编码器+按键），接线更简单：

### 标准9针定义
```
控制板9针接口         ESP32-C6
┌───────────────┐    ┌─────────────┐
│ 1. VCC        ├────┤ 3.3V        │
│ 2. GND        ├────┤ GND         │
│ 3. SDA        ├────┤ GPIO 22 ⚠️  │  ← 注意新引脚
│ 4. SCL        ├────┤ GPIO 23 ⚠️  │  ← 注意新引脚
│ 5. ENC_CLK    ├────┤ GPIO 10     │
│ 6. ENC_DT     ├────┤ GPIO 11     │
│ 7. BTN1       ├────┤ GPIO 12     │
│ 8. BTN2       ├────┤ GPIO 13     │
│ 9. ENC_SW     ├────┤ 不连接       │  ← 默认不接
└───────────────┘    └─────────────┘
```

**⚠️ 重要**: 
- 如果控制板固定使用GPIO 8/9作为I2C，需要修改硬件跳线
- 或在代码中改回GPIO 8/9（放弃板载RGB LED功能）

## 🔧 硬件配置选项

### 选项A：使用新配置（推荐）
- ✅ I2C: GPIO 22/23
- ✅ RGB LED: GPIO 8 (板载)
- ✅ 功能完整

### 选项B：使用原配置
如需使用GPIO 8/9作为I2C：
1. 修改 `include/config.h`:
   ```cpp
   #define I2C_SDA 8
   #define I2C_SCL 9
   #define RGB_LED_PIN 15  // 外接LED
   ```
2. 放弃板载RGB LED，或外接LED到GPIO 15

## 📋 硬件检查清单

上传前请检查：

- [ ] MAX6675连接到GPIO 4/5/6
- [ ] I2C OLED连接到**GPIO 22/23** (不是8/9)
- [ ] 编码器连接到GPIO 10/11
- [ ] 确认键连接到GPIO 12
- [ ] 返回键连接到GPIO 13
- [ ] 继电器连接到GPIO 7
- [ ] 板载RGB LED无需接线（GPIO 8自动控制）
- [ ] 所有GND共地
- [ ] 3.3V供电稳定

## 🐛 常见接线问题

### OLED不显示
1. ✅ 确认SDA/SCL连接到GPIO 22/23
2. ✅ 检查I2C地址（0x3C或0x3D）
3. ✅ 确认3.3V供电
4. ❌ 不要连接到GPIO 8/9

### 温度读取失败
1. ✅ 检查MAX6675接线
2. ✅ 确认热电偶极性
3. ✅ 等待1秒预热时间

### RGB LED不亮
1. ✅ 板载LED在GPIO 8无需接线
2. ✅ 检查代码是否编译成功
3. ✅ 查看串口确认初始化

### 按键无响应
1. ✅ 确认按键连接到GPIO 12/13
2. ✅ 另一端必须接GND
3. ✅ 内部已启用上拉，无需外部电阻

## 📸 照片示例

建议拍摄您的实际接线：
- 整体布局图
- 各模块特写
- 接线端子细节

## 🔗 参考资料

- [nanoESP32-C6原理图](https://github.com/wuxx/nanoESP32-C6/tree/master/hardware)
- [MAX6675数据手册](https://datasheets.maximintegrated.com/en/ds/MAX6675.pdf)
- [SSD1306 OLED规格书](https://cdn-shop.adafruit.com/datasheets/SSD1306.pdf)

---

**文档版本**: v1.2  
**最后更新**: 2026-02-12  
**适用硬件**: nanoESP32-C6 v1.0
