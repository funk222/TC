# ESP32-C6 Temperature Controller

åŸºäº nanoESP32-C6 v1.0 çš„åŒä¼ æ„Ÿå™¨æ¸©æ§é¡¹ç›®ï¼ˆMAX31865 PT100 + MAX6675ï¼‰ã€‚

## ğŸ¯ å½“å‰åŠŸèƒ½

- âœ… ä¸»æ¸©åº¦ä¼ æ„Ÿå™¨ï¼šMAX31865 + PT100ï¼ˆç”¨äºæ§åˆ¶ï¼‰
- âœ… T1 è½»åº¦å¹³æ»‘ï¼ˆEMAï¼‰ï¼Œæ˜¾ç¤ºä¸æ§åˆ¶æ›´ç¨³å®š
- âœ… ç¬¬äºŒæ¸©åº¦ä¼ æ„Ÿå™¨ï¼šMAX6675ï¼ˆå®‰å…¨è”é”ï¼‰
- âœ… SSR æ§åˆ¶è”é”ï¼šT2 æœ‰æ•ˆä¸”è¶…é™æ—¶å¼ºåˆ¶å…³æ–­ï¼›T2 æ— æ•ˆæ—¶å…è®¸ T1 ç»§ç»­æ§åˆ¶
- âœ… OLED å®æ—¶æ˜¾ç¤ºï¼ˆé¦–é¡µå¤§å­—ä½“æ¸©åº¦ + çŠ¶æ€åŒºï¼‰
- âœ… èœå•é˜²è¯¯æŒ‰ï¼šäºŒçº§ç¡®è®¤èœå•
- âœ… Factory Resetï¼šæ¸…ç©ºä¿å­˜å‚æ•°å¹¶æ¢å¤é»˜è®¤
- âœ… å‚æ•°æŒä¹…åŒ–ï¼šç›®æ ‡æ¸©åº¦/æ»å/å®‰å…¨ä¸Šä¸‹é™ä¿å­˜åˆ° NVS
- âœ… é‡å¯ç­–ç•¥ï¼šç³»ç»Ÿé‡å¯å `SYS` å›ºå®šä¸º `ON`
- âœ… å±å¹•ä¿æŠ¤ï¼šæ”¯æŒå¼€å…³ä¸æ—¶é•¿ï¼ˆ`ScrTm`ï¼‰è®¾ç½®ï¼Œå¹¶ä¿å­˜åˆ° NVS
- âœ… ç¼–ç å™¨æŠ—æŠ–ä¼˜åŒ–ï¼šå››ç›¸çŠ¶æ€è¡¨è§£ç  + æ•´å¡ç‚¹è®¡æ­¥ï¼Œèœå•é€‰æ‹©æ›´ç¨³å®š
- âœ… RGB LED æŠ¥è­¦åºåˆ—
- âœ… å†…ç½®ç½‘é¡µçŠ¶æ€é¡µï¼ˆå®æ—¶æ˜¾ç¤º T1/T2/Heat/Sysï¼‰
- âœ… WiFi åŒæ­¥æ¥å£ï¼ˆä¾›å‰¯ESP32é•œåƒæ˜¾ç¤ºçŠ¶æ€ï¼‰
- âœ… ç½‘é¡µæ§åˆ¶ï¼ˆSYS å¼€å…³ã€ç›®æ ‡æ¸©åº¦è®¾ç½®ï¼‰+ æ—¥å¿—ä¸‹è½½
- âœ… æ—¥å¿—æ–‡ä»¶è‡ªåŠ¨è½®è½¬ï¼ˆè¶…å¤§å°è‡ªåŠ¨åˆ é™¤æ—§æ—¥å¿—ï¼‰

## ğŸ“¦ ç¡¬ä»¶éœ€æ±‚

- nanoESP32-C6 v1.0
- MAX6675 + K å‹çƒ­ç”µå¶
- MAX31865 + PT100
- SSD1306 OLEDï¼ˆI2Cï¼‰
- SSR/ç»§ç”µå™¨ï¼ˆåŠ çƒ­è¾“å‡ºï¼‰
- æ—‹è½¬ç¼–ç å™¨ï¼ˆCLK/DT/SWï¼‰
- ä¸¤ä¸ªæŒ‰é”®ï¼ˆMenu / Backï¼‰

## ğŸ”Œ å¼•è„šåˆ†é…ï¼ˆå½“å‰ï¼‰

| GPIO | åŠŸèƒ½ |
|------|------|
| 4 | MAX6675 SO |
| 5 | MAX6675 CS |
| 6 | MAX6675 SCK |
| 7 | SSR è¾“å‡º |
| 8 | æ¿è½½ WS2812 RGB |
| 10 | ç¼–ç å™¨ CLK |
| 11 | ç¼–ç å™¨ DT |
| 12 | ç¼–ç å™¨ SWï¼ˆç¡®è®¤/æ‰§è¡Œï¼‰ |
| 13 | Menu é”®ï¼ˆæ‰“å¼€å¼¹å‡ºèœå•ï¼‰ |
| 21 | Back é”® |
| 22 | I2C SDAï¼ˆOLEDï¼‰ |
| 23 | I2C SCLï¼ˆOLEDï¼‰ |
| 9 | MAX31865 CS |
| 15 | MAX31865 MOSI |
| 4 | MAX31865 MISOï¼ˆä¸ MAX6675 SO å…±ç”¨ï¼‰ |
| 6 | MAX31865 SCKï¼ˆä¸ MAX6675 SCK å…±ç”¨ï¼‰ |

## ğŸ§  æ§åˆ¶é€»è¾‘

1. ç¬¬ä¸€ä¼ æ„Ÿå™¨ `T1`ï¼ˆMAX31865 + PT100ï¼‰è´Ÿè´£æ¸©æ§æ»åç®—æ³•ã€‚
  - `T1` è¯»æ•°ç»è¿‡ EMA å¹³æ»‘ï¼ˆç³»æ•°æ¥è‡ª `T1_SMOOTHING_ALPHA`ï¼‰ç”¨äºæ˜¾ç¤ºä¸æ§åˆ¶
  - å®‰å…¨è¾¹ç•Œä¿æŠ¤ä½¿ç”¨ `T1` åŸå§‹è¯»æ•°ï¼Œé¿å…å¹³æ»‘é€ æˆä¿æŠ¤å»¶è¿Ÿ
2. ç¬¬äºŒä¼ æ„Ÿå™¨ `T2`ï¼ˆMAX6675ï¼‰è´Ÿè´£è”é”ï¼š
  - `T2` è¯»æ•°ç»è¿‡ EMA å¹³æ»‘ï¼ˆç³»æ•°æ¥è‡ª `T2_SMOOTHING_ALPHA`ï¼‰ç”¨äºæ˜¾ç¤ºä¸æ—¥å¿—
  - è”é”åˆ¤æ–­ä½¿ç”¨ `T2` åŸå§‹è¯»æ•°ï¼Œé¿å…å¹³æ»‘å¯¼è‡´å…³æ–­å»¶è¿Ÿ
  - `T2` æœ‰æ•ˆä¸” `T2 >= T2Mx` â†’ å¼ºåˆ¶å…³é—­ SSR
  - `T2` æ— æ•ˆï¼Œæˆ– `T2 < T2Mx` â†’ å…è®¸ T1 æ§åˆ¶ SSR
3. å®‰å…¨è¾¹ç•Œï¼šå½“å‰æ¸©åº¦è¶…å‡º `[Low, High]` ä¼šè§¦å‘ä¿æŠ¤å¹¶å…³é—­ç³»ç»Ÿã€‚

## ğŸ›ï¸ èœå•æ“ä½œï¼ˆå½“å‰äº¤äº’ï¼‰

### é¦–é¡µ
- æ˜¾ç¤ºå¤§å­—ä½“æ¸©åº¦ï¼ˆå½“å‰/è®¾å®šï¼‰ä¸çŠ¶æ€ä¿¡æ¯
- `Menu` é”®ï¼ˆGPIO13ï¼‰æ‰“å¼€å¼¹å‡ºèœå•

### å¼¹å‡ºèœå•
- æ—‹é’®é€‰æ‹©æ¡ç›®ï¼Œ`SW` æ‰§è¡Œ
- åŒ…å«ï¼š
  - `Set Target`
  - `SYS: ON/OFF`
  - `Settings`
  - `Factory Reset`

### äºŒçº§ç¡®è®¤ï¼ˆé˜²è¯¯æŒ‰ï¼‰
- å¯¹ `SYS` åˆ‡æ¢å’Œ `Factory Reset` è¿›å…¥ç¡®è®¤é¡µ
- `SW(GPIO12): YES`ï¼Œ`BACK(GPIO21): NO`

## âš™ï¸ å…³é”®é»˜è®¤å‚æ•°ï¼ˆæ¥è‡ª config.hï¼‰

- ç›®æ ‡æ¸©åº¦é»˜è®¤ï¼š`80.0Â°C`ï¼ˆå¯è°ƒèŒƒå›´ `5~85Â°C`ï¼Œæ­¥è¿› `0.5Â°C`ï¼‰
- T1 æ»åé»˜è®¤ï¼š`2.0Â°C`ï¼ˆèŒƒå›´ `0.1~20.0Â°C`ï¼‰
- T1 å¹³æ»‘ç³»æ•°ï¼š`T1_SMOOTHING_ALPHA = 0.25`
- T2 å¹³æ»‘ç³»æ•°ï¼š`T2_SMOOTHING_ALPHA = 0.20`
- å®‰å…¨è¾¹ç•Œé»˜è®¤ï¼š`Low=5Â°C`ï¼Œ`High=95Â°C`ï¼ˆå¯è°ƒä¸Šé™ `90Â°C`ï¼‰
- T2 è”é”é»˜è®¤ä¸Šé™ï¼š`150Â°C`ï¼ˆå¯è°ƒ `0~200Â°C`ï¼‰
- T2 è”é”å›å·®é»˜è®¤ï¼š`2.0Â°C`ï¼ˆèŒƒå›´ `0~20Â°C`ï¼‰
- å±ä¿é»˜è®¤ï¼šå¼€å¯ï¼Œé»˜è®¤è¶…æ—¶ `10min`ï¼ˆå¯è°ƒ `1~100min`ï¼Œæ­¥è¿› `1min`ï¼‰
- å‘¨æœŸå‚æ•°ï¼šæ¸©åº¦æ›´æ–° `500ms`ã€æ˜¾ç¤ºæ›´æ–° `500ms`ã€ç½‘é¡µæ—¥å¿—å†™å…¥ `10s`
- ç½‘é¡µå®‰å…¨ï¼šè¿ç»­è¾“é”™ `5` æ¬¡å°ç¦ `300s`

### Settings
- å¯è°ƒå‚æ•°ï¼š
  - `Hys`
  - `Low`
  - `High`
  - `T2Mx`
  - `T2Hy`
  - `ScrSv`ï¼ˆå±ä¿å¼€å…³ï¼‰
  - `ScrTm`ï¼ˆå±ä¿æ—¶é•¿ï¼Œåˆ†é’Ÿï¼‰
- `SW` è¿›å…¥/é€€å‡ºç¼–è¾‘
- å‚æ•°ä¼šè‡ªåŠ¨æŒä¹…åŒ–åˆ° NVS
- `ScrTm` èŒƒå›´ï¼š1~100 åˆ†é’Ÿï¼ˆæ­¥è¿› 1 åˆ†é’Ÿï¼‰

## ğŸ’¾ æŒä¹…åŒ–ä¸é‡å¯è¡Œä¸º

ä¿å­˜åˆ° NVS çš„å‚æ•°ï¼š
- `targetTemp`
- `tempHysteresis`
- `safetyLowerTemp`
- `safetyUpperTemp`
- `secondaryTempLimit`
- `secondaryTempHysteresis`
- `screenSaverEnabled`
- `screenSaverTimeoutMs`

é‡å¯åï¼š
- ä¸Šè¿°å‚æ•°ä¼šæ¢å¤
- `systemEnabled` å¼ºåˆ¶è®¾ä¸º `ON`

## ğŸ¨ LED çŠ¶æ€

- é«˜æ¸©æŠ¥è­¦ï¼šçº¢é—ªä¸¤ä¸‹ + è“é—ªä¸€ä¸‹ï¼ˆå¾ªç¯ï¼‰
- ä½æ¸©æŠ¥è­¦ï¼šè“é—ªä¸¤ä¸‹ + çº¢é—ªä¸€ä¸‹ï¼ˆå¾ªç¯ï¼‰
- ä¼ æ„Ÿå™¨é”™è¯¯ï¼šç´«è‰²é—ªçƒ
- åŠ çƒ­ä¸­ï¼šæ©™è‰²/çº¢è‰²çŠ¶æ€æŒ‡ç¤ºï¼ˆæŒ‰å½“å‰é€»è¾‘ï¼‰

## ğŸš€ æ„å»ºä¸ä¸Šä¼ 

```bash
pio run -e esp32-c6-devkitc-1
pio run -e esp32-c6-devkitc-1 -t upload
pio device monitor
```

### ğŸ” åŒä»“åº“åˆ‡æ¢ç¼–è¯‘ç›®æ ‡

```bash
# ä¸»æ§ï¼ˆæ¸©æ§å™¨ï¼‰
pio run -e esp32-c6-devkitc-1
pio run -e esp32-c6-devkitc-1 -t upload

# å‰¯æœºï¼ˆWiFié•œåƒæ˜¾ç¤ºï¼‰
pio run -e esp8266-hw-364a
pio run -e esp8266-hw-364a -t upload
```

å‰¯æœºæºç å…¥å£ï¼š`src/receiver_main.cpp`

## ğŸŒ ç½‘é¡µçŠ¶æ€é¡µ

- è®¾å¤‡ä¼šä»¥ STA æ¨¡å¼è¿æ¥åˆ° `include/config.h` ä¸­é…ç½®çš„ `WIFI_SSID`
- Wi-Fi å¯†ç æ¥è‡ª `include/config.h` ä¸­é…ç½®çš„ `WIFI_PASSWORD`
- ä¸Šç”µååœ¨ä¸²å£æ—¥å¿—æŸ¥çœ‹ `IP`ï¼Œæµè§ˆå™¨è®¿é—®ï¼š`http://<è®¾å¤‡IP>/`
- JSON æ¥å£ï¼š`http://<è®¾å¤‡IP>/api/status`
- åŒæ­¥æ¥å£ï¼š`http://<è®¾å¤‡IP>/api/sync/status`ï¼ˆå¯é€‰ `?key=...`ï¼‰
- æ§åˆ¶æ¥å£ï¼š`/api/control?sys=on|off|toggle`ã€`/api/control?target=xx.x`
- è®¾ç½®æ¥å£ï¼š`/api/settings`ã€`/api/settings/update`ï¼ˆå« `hys/low/high/t2max/t2hy/scrsv/scrtm`ï¼‰
- æ—¥å¿—ä¸‹è½½ï¼š`http://<è®¾å¤‡IP>/logs/download`
- æ‰‹åŠ¨æ¸…é™¤æ—¥å¿—ï¼šç½‘é¡µ `Clear Logs` æŒ‰é’®ï¼ˆ`POST /api/logs/clear`ï¼‰
- æ—¥å¿—ç­–ç•¥ï¼šå½“æ—¥å¿—æ–‡ä»¶è¿‡å¤§æ—¶è‡ªåŠ¨è½®è½¬ï¼Œå½“å‰æ—¥å¿—ä¸º `status.csv`
- æ—¥å¿—å­—æ®µï¼ˆCSVï¼‰ï¼š`date,time,T1,T1set,T2,Heat`
- CSV åŒ…å«è¡¨å¤´é¦–è¡Œï¼š`date,time,T1,T1set,T2,Heat`
- æ—¶é—´æ ¼å¼ï¼šæ—¥æœŸ `yyyy/mm/dd`ï¼Œæ—¶é—´ `hh:mm:ss`
- è‹¥ NTP æ—¶é—´æœªåŒæ­¥ï¼Œæ—¥æœŸå›é€€ä¸º `1970/01/01`ï¼Œæ—¶é—´ä½¿ç”¨è¿è¡Œæ—¶ `hh:mm:ss`

### ğŸ“¡ å‰¯ESP32é•œåƒæ˜¾ç¤º

- æ–‡æ¡£ï¼š`docs/ESP32_WIFI_SYNC.md`
- å‰¯æœºç¤ºä¾‹ï¼š`docs/ESP32_WIFI_MIRROR_RECEIVER.ino`
- ä¸»æœºå¯åœ¨ `include/config.h` è®¾ç½®ï¼š`WIFI_SYNC_ENDPOINT_ENABLED`ã€`WIFI_SYNC_API_KEY`

### ğŸ” ç½‘é¡µå®‰å…¨è®¿é—®

- ç¬¬ä¸€æ¬¡è®¿é—®éœ€å…ˆåˆ›å»ºç½‘é¡µå¯†ç 
- åˆ›å»ºåå¿…é¡»ç™»å½•ï¼Œæœªç™»å½•æˆ–å¯†ç é”™è¯¯æ— æ³•è®¿é—®çŠ¶æ€/è®¾ç½®/æ§åˆ¶/æ—¥å¿—ä¸‹è½½
- åŒä¸€è®¿é—® IP è¿ç»­è¾“é”™ 5 æ¬¡å¯†ç ï¼Œå°†è¢«å°ç¦ 5 åˆ†é’Ÿ
- ç™»å½•åå¯åœ¨ç½‘é¡µç«¯ä¿®æ”¹è®¾ç½®å‚æ•°å¹¶ä¿å­˜

## ğŸ“š ä¾èµ–åº“

ç”± PlatformIO è‡ªåŠ¨å®‰è£…ï¼ˆè§ `platformio.ini`ï¼‰ï¼š
- adafruit/MAX6675 library
- adafruit/Adafruit MAX31865 library
- adafruit/Adafruit GFX Library
- adafruit/Adafruit SSD1306
- adafruit/Adafruit BusIO
- adafruit/Adafruit NeoPixel

## ğŸ§© å…³é”®é…ç½®æ–‡ä»¶

- `include/config.h`ï¼šå¼•è„šã€é˜ˆå€¼ã€é—´éš”ã€é»˜è®¤å‚æ•°
- `src/main.cpp`ï¼šèœå•ã€æ¸©æ§ã€è”é”ã€æŠ¥è­¦ã€æŒä¹…åŒ–é€»è¾‘
- `platformio.ini`ï¼šæ¿å¡ä¸åº“ä¾èµ–

## ğŸ“„ License

MIT
